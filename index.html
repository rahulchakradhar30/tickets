<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>District-style Ticket Generator (No QR)</title>
<style>
  :root{
    --bg1:#000;
    --bg2:#071428;
    --panel:#0b0b0d;
    --muted:#9aa3ad;
    --accent:#ff6b6b;
    --white:#ffffff;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    background: radial-gradient(1000px 600px at 10% 10%, #081220 0%, transparent 20%),
                radial-gradient(800px 500px at 90% 90%, #08121a 0%, transparent 20%),
                linear-gradient(180deg,var(--bg1),var(--bg2) 60%);
    color:var(--white);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
  }

  .layout{
    width:100%;
    max-width:1180px;
    display:grid;
    grid-template-columns:1fr 520px;
    gap:28px;
  }

  .panel{
    background: linear-gradient(180deg,#07101a,#07111b);
    border-radius:12px;
    padding:20px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  }
  h2{ margin:0 0 6px; font-size:20px; color:#e9eef6; }
  .hint{ color:var(--muted); margin:6px 0 12px; font-size:13px; }

  label{ display:block; font-size:13px; color:var(--muted); margin-top:12px; margin-bottom:6px; }
  input[type="text"], input[type="date"], input[type="time"], input[type="file"]{
    width:100%;
    padding:10px 12px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.04);
    background:rgba(255,255,255,0.02);
    color:var(--white);
    font-size:14px;
  }
  .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
  .actions{ display:flex; gap:12px; margin-top:14px; }
  .btn{
    padding:12px 14px; border-radius:10px; border:none; font-weight:700; cursor:pointer; font-size:14px;
  }
  .btn.primary{ background: linear-gradient(90deg,var(--accent),#ee5a24); color:#fff; flex:1; }
  .btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--white); width:110px; }

  /* preview ticket */
  .preview-wrap{ display:flex; align-items:center; justify-content:center; }
  .ticket{
    width:420px; background:linear-gradient(180deg,#0a0a0b,#0b0b0d); border-radius:20px; padding:18px; box-shadow:0 18px 40px rgba(0,0,0,0.6);
    color:#fff; position:relative; overflow:hidden; font-size:14px;
  }

  /* top header (pattern area + logo) */
  .ticket .header{
    height:86px;
    background: linear-gradient(180deg,#14121a,#0b0b0d);
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    margin:-18px -18px 12px -18px;
    position:relative;
  }
  .logo-img{ width:160px; height:auto; display:block; filter: drop-shadow(0 6px 18px rgba(0,0,0,0.6)); }

  .top{
    display:flex; gap:12px; align-items:center;
  }
  .poster{
    width:58px; height:86px; border-radius:6px; background:linear-gradient(180deg,#222,#111);
    overflow:hidden; flex:0 0 58px; display:flex; align-items:center; justify-content:center; border:4px solid rgba(255,255,255,0.06);
  }
  .poster img{ width:100%; height:100%; object-fit:cover; display:block; }

  .title{ font-weight:800; font-size:18px; color:#fff; line-height:1.05; }
  .meta{ color:var(--muted); font-size:12px; margin-top:6px; }

  .big-placeholder{
    width:220px; height:220px; background:#fff; border-radius:18px; display:block;
    margin:18px auto; box-shadow: 0 10px 20px rgba(0,0,0,0.4);
  }

  .ticket .info{ text-align:center; margin-top:6px; }
  .ticket .info .line{ font-size:12px; color:var(--muted); margin-top:8px; letter-spacing:1px; }
  .ticket .info .value{ font-weight:800; font-size:14px; margin-top:6px; }

  /* perforation and bottom */
  .perforation{
    height:28px;
    display:flex;
    align-items:center;
    justify-content:center;
    margin-top:14px;
    position:relative;
  }
  .perforation::before{
    content:"";
    width:70%;
    height:2px;
    border-top:2px dashed rgba(255,255,255,0.08);
    display:block;
  }
  .address{
    padding:18px 22px; text-align:center; color:#d2d2d2; font-size:14px; line-height:1.4;
  }
  .booking{ color:rgba(255,255,255,0.6); font-size:12px; text-align:center; margin-top:6px; }

  /* bottom branding */
  .bottom-bar{
    width:100%;
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-top:22px;
    gap:12px;
  }
  .bottom-logo{ width:140px; height:auto; opacity:0.95; filter: drop-shadow(0 6px 16px rgba(0,0,0,0.6)); }
  .hashtag{ font-weight:800; font-size:28px; color:#fff; letter-spacing:0.6px; }

  .controls{ display:flex; gap:10px; margin-top:12px; align-items:center; flex-wrap:wrap; }
  .select{ padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:#fff; }

  @media (max-width:920px){
    .layout{ grid-template-columns:1fr; }
    .preview-wrap{ margin-top:18px; justify-content:center; }
  }
</style>
</head>
<body>

<div class="layout">
  <!-- Left: form -->
  <div class="panel">
    <h2>District Ticket — Generator (no QR)</h2>
    <p class="hint">Upload poster (optional). Fill details. Generate preview and download ticket PNG. QR placeholder will be blank — paste QR manually using PicsArt.</p>

    <label>Movie Poster (optional)</label>
    <input id="posterFile" type="file" accept="image/*">

    <label>Movie Title</label>
    <input id="movieName" type="text" placeholder="Akhanda 2: Thaandavam">

    <div class="grid2">
      <div>
        <label>Movie Date</label>
        <input id="movieDate" type="date">
      </div>
      <div>
        <label>Movie Time</label>
        <input id="movieTime" type="time">
      </div>
    </div>

    <div class="grid2">
      <div>
        <label>Theatre</label>
        <input id="theatre" type="text" placeholder="V Mega Anand Cine Complex, National Highway 18, Kurnool">
      </div>
      <div>
        <label>Screen</label>
        <input id="screen" type="text" placeholder="Screen-1">
      </div>
    </div>

    <label>Seats (comma separated)</label>
    <input id="seats" type="text" placeholder="GOLD-B9">

    <div class="grid2" style="margin-top:12px;">
      <div>
        <label>Language / Format</label>
        <input id="lang" type="text" placeholder="Telugu | 2D">
      </div>
      <div>
        <label>Booking ID (optional)</label>
        <input id="booking" type="text" placeholder="Leave empty to auto-generate">
      </div>
    </div>

    <div class="actions">
      <button class="btn primary" onclick="generatePreview()">Generate Preview</button>
      <button class="btn ghost" onclick="resetAll()">Reset</button>
    </div>

    <div style="margin-top:14px;">
      <label>Export Mode</label>
      <div class="controls">
        <select id="exportMode" class="select">
          <option value="standard">Standard (1600px height)</option>
          <option value="district">District Original (720×1280)</option>
        </select>
        <button class="btn primary" onclick="downloadTicketFromUI()">Download Ticket</button>
      </div>
    </div>

    <p class="small" style="margin-top:12px;color:var(--muted)">After preview, click <strong>Download Ticket</strong> to save. Then paste QR using PicsArt into the white square placeholder.</p>
  </div>

  <!-- Right: preview -->
  <div class="preview-wrap">
    <div class="ticket" id="ticketPreview" role="presentation" aria-label="Ticket preview">
      <div class="header" id="headerArea">
        <!-- TOP compact logo (glowing district) -->
        <img id="logoImg" class="logo-img" alt="district logo"
             src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="420" height="90" viewBox="0 0 420 90"><defs><filter id="g" x="-50%" y="-50%" width="200%" height="200%"><feGaussianBlur stdDeviation="2.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><rect width="420" height="90" fill="none"/><text x="50%" y="60%" text-anchor="middle" font-family=\"Inter, Arial, sans-serif\" font-weight=\"800\" font-size=\"46\" fill=\"%23ffffff\" filter=\"url(%23g)\">district</text></svg>' />
      </div>

      <div class="top">
        <div class="poster" id="posterPreview"><img id="posterImg" src="" alt="poster" style="display:none"></div>
        <div style="flex:1; padding-right:8px">
          <div class="title" id="pvTitle">Movie Title</div>
          <div class="meta" id="pvMeta">Telugu | 2D</div>
        </div>
        <div style="text-align:right; width:86px;">
          <div id="pvDate">Date</div>
          <div class="meta" id="pvTime">Time</div>
        </div>
      </div>

      <div class="big-placeholder" id="qrPlaceholder" aria-hidden="true">
        <!-- intentionally blank white box for manual QR placement -->
      </div>

      <div class="info">
        <div class="line">SCREEN</div>
        <div class="value" id="pvScreen">-</div>

        <div class="line" style="margin-top:10px">SEAT</div>
        <div class="value" id="pvSeats">-</div>

        <div class="line" style="margin-top:10px">THEATRE</div>
        <div class="value" id="pvTheatre">-</div>
      </div>

      <div class="perforation" aria-hidden="true"></div>

      <div class="address" id="pvAddress">Theatre address will appear here</div>

      <div class="booking" id="pvBooking">Booking ID: -</div>

      <div class="bottom-bar">
        <!-- bottom logo (your uploaded PNG raw link) -->
        <img id="bottomLogo" class="bottom-logo" alt="district" src="https://github.com/rahulchakradhar30/tickets/blob/main/brand-logo.png?raw=true" />
        <div class="hashtag">#SeeYouThere</div>
      </div>

    </div>
  </div>
</div>

<script>
(function(){
  // Elements
  const posterFile = document.getElementById('posterFile');
  const posterImg = document.getElementById('posterImg');
  const posterPreview = document.getElementById('posterPreview');

  const pvTitle = document.getElementById('pvTitle');
  const pvMeta = document.getElementById('pvMeta');
  const pvDate = document.getElementById('pvDate');
  const pvTime = document.getElementById('pvTime');
  const pvScreen = document.getElementById('pvScreen');
  const pvSeats = document.getElementById('pvSeats');
  const pvTheatre = document.getElementById('pvTheatre');
  const pvAddress = document.getElementById('pvAddress');
  const pvBooking = document.getElementById('pvBooking');

  const bigPlaceholder = document.getElementById('qrPlaceholder');
  const headerArea = document.getElementById('headerArea');

  // defaults
  function setDefaults(){
    const now = new Date();
    document.getElementById('movieDate').value = now.toISOString().split('T')[0];
    let hh = String(now.getHours()).padStart(2,'0');
    let mm = now.getMinutes() < 30 ? '00' : '30';
    document.getElementById('movieTime').value = hh + ':' + mm;
    document.getElementById('lang').value = 'Telugu | 2D';
  }
  setDefaults();

  // poster handling
  let posterDataUrl = null;
  posterFile.addEventListener('change', function(ev){
    const f = ev.target.files && ev.target.files[0];
    if(!f){ posterDataUrl = null; posterImg.style.display='none'; posterPreview.style.background=''; return; }
    const reader = new FileReader();
    reader.onload = function(e){
      posterDataUrl = e.target.result;
      posterImg.src = posterDataUrl;
      posterImg.style.display = 'block';
      posterPreview.style.background = '';
    };
    reader.readAsDataURL(f);
  });

  function genBooking(){
    return 'BK-' + Date.now().toString().slice(-10);
  }

  // preview generator
  window.generatePreview = function(){
    const movieName = document.getElementById('movieName').value.trim() || 'Movie Title';
    const movieDate = document.getElementById('movieDate').value;
    const movieTime = document.getElementById('movieTime').value;
    const theatre = document.getElementById('theatre').value.trim() || 'V Mega Anand Cine Complex, National Highway 18, Kurnool';
    const screen = document.getElementById('screen').value.trim() || 'Screen-1';
    const seats = document.getElementById('seats').value.trim() || 'GOLD-B9';
    const lang = document.getElementById('lang').value.trim() || 'Telugu | 2D';
    const booking = document.getElementById('booking').value.trim() || genBooking();

    pvTitle.textContent = movieName;
    pvMeta.textContent = lang;
    try{
      const dObj = new Date(movieDate + 'T' + movieTime);
      const opts = { weekday: 'short', day: 'numeric', month: 'short' };
      pvDate.textContent = dObj.toLocaleDateString(undefined, opts);
      pvTime.textContent = new Date('1970-01-01T' + movieTime).toLocaleTimeString([], {hour:'numeric', minute:'2-digit'});
    }catch(e){
      pvDate.textContent = movieDate || 'Date';
      pvTime.textContent = movieTime || 'Time';
    }
    pvScreen.textContent = screen.toUpperCase();
    pvSeats.textContent = seats.toUpperCase();
    pvTheatre.textContent = theatre;
    pvAddress.textContent = theatre;
    pvBooking.textContent = 'Booking ID: ' + booking;

    // poster preview fallback
    if(posterDataUrl){
      posterImg.src = posterDataUrl;
      posterImg.style.display = 'block';
      posterPreview.style.background = '';
    } else {
      posterImg.style.display = 'none';
      posterPreview.style.background = 'linear-gradient(180deg,#2a2a2a,#111)';
    }
  };

  // reset
  window.resetAll = function(){
    document.getElementById('movieName').value = '';
    document.getElementById('theatre').value = '';
    document.getElementById('screen').value = '';
    document.getElementById('seats').value = '';
    document.getElementById('booking').value = '';
    posterFile.value = '';
    posterImg.src = '';
    posterImg.style.display = 'none';
    posterPreview.style.background = '';
    setDefaults();
    pvTitle.textContent = 'Movie Title';
    pvMeta.textContent = 'Telugu | 2D';
    pvDate.textContent = 'Date';
    pvTime.textContent = 'Time';
    pvScreen.textContent = '-';
    pvSeats.textContent = '-';
    pvTheatre.textContent = '-';
    pvAddress.textContent = 'Theatre address will appear here';
    pvBooking.textContent = 'Booking ID: -';
  };

  // Download helper: draws the ticket card to canvas sized W x H and triggers download
  function buildAndDownload(W, H, filename){
    const off = document.createElement('canvas');
    off.width = W; off.height = H;
    const ctx = off.getContext('2d');

    // background for card shadow area
    ctx.fillStyle = '#000';
    ctx.fillRect(0,0,W,H);

    // card area (we'll center a card with rounded corners)
    const cardW = Math.round(W * 0.84); // width relative
    const cardH = Math.round(H * 0.86);
    const cx = Math.round((W - cardW)/2);
    const cy = Math.round((H - cardH)/2);

    // Draw rounded card background
    ctx.fillStyle = '#0f1113';
    roundRect(ctx, cx, cy, cardW, cardH, Math.round(cardW*0.03), true, false);

    // header area height (proportional)
    const headerH = Math.round(cardH * 0.12);
    const innerPad = Math.round(cardW * 0.05);

    // header rectangle (darker)
    ctx.fillStyle = '#14121a';
    roundRect(ctx, cx + innerPad/2, cy + innerPad/2, cardW - innerPad, headerH, Math.round(cardW*0.02), true, false);

    // draw top compact glowing logo (embedded SVG URI)
    const topLogo = new Image();
    topLogo.crossOrigin = 'anonymous';
    topLogo.onload = function(){
      const logoW = Math.round(cardW * 0.42);
      const logoH = Math.round(topLogo.height/topLogo.width * logoW);
      ctx.drawImage(topLogo, cx + (cardW - logoW)/2, cy + innerPad/2 + Math.round((headerH - logoH)/2), logoW, logoH);
      afterTopLogo();
    };
    topLogo.onerror = function(){ afterTopLogo(); };
    topLogo.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="420" height="90" viewBox="0 0 420 90"><defs><filter id="g" x="-50%" y="-50%" width="200%" height="200%"><feGaussianBlur stdDeviation="2.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><rect width="420" height="90" fill="none"/><text x="50%" y="60%" text-anchor="middle" font-family=\'Inter, Arial, sans-serif\' font-weight="800" font-size="46" fill=\'%23ffffff\' filter="url(%23g)">district</text></svg>';

    function afterTopLogo(){
      // compute poster/title/date area coordinates (below header)
      const topY = cy + headerH + innerPad;
      const posterW = Math.round(cardW * 0.18);
      const posterH = Math.round(posterW * 1.45);
      const posterX = cx + innerPad;
      const posterY = topY + 6;

      // draw poster background + image (if loaded)
      roundRect(ctx, posterX - 6, posterY - 6, posterW + 12, posterH + 12, 10, true, false);
      if(posterDataUrl){
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = function(){
          // fit cover
          const scale = Math.max(posterW / img.width, posterH / img.height);
          const sw = Math.round(posterW / scale), sh = Math.round(posterH / scale);
          const sx = Math.round((img.width - sw) / 2), sy = Math.round((img.height - sh) / 2);
          ctx.drawImage(img, sx, sy, sw, sh, posterX, posterY, posterW, posterH);
          afterPoster();
        };
        img.onerror = function(){
          // placeholder fill
          ctx.fillStyle = '#222';
          roundRect(ctx, posterX, posterY, posterW, posterH, 8, true, false);
          ctx.fillStyle = '#666';
          ctx.font = Math.round(cardW*0.03) + 'px Arial';
          ctx.fillText('POSTER', posterX + 12, posterY + 36);
          afterPoster();
        };
        img.src = posterDataUrl;
      } else {
        ctx.fillStyle = '#222';
        roundRect(ctx, posterX, posterY, posterW, posterH, 8, true, false);
        ctx.fillStyle = '#666';
        ctx.font = Math.round(cardW*0.03) + 'px Arial';
        ctx.fillText('POSTER', posterX + 12, posterY + 36);
        afterPoster();
      }

      function afterPoster(){
        // Title and meta area to the right of poster
        const titleX = posterX + posterW + Math.round(cardW*0.03);
        const titleW = cx + cardW - innerPad - titleX;
        // Title
        ctx.fillStyle = '#fff';
        ctx.font = '700 ' + Math.round(cardW*0.045) + 'px Arial';
        wrapText(ctx, pvTitle.textContent, titleX, posterY + 8, titleW, Math.round(cardW*0.055));

        // meta
        ctx.fillStyle = '#bdbdbd';
        ctx.font = Math.round(cardW*0.025) + 'px Arial';
        ctx.fillText(pvMeta.textContent, titleX, posterY + Math.round(cardW*0.055) + 60);

        // date/time on far right
        ctx.textAlign = 'right';
        ctx.fillStyle = '#fff';
        ctx.font = Math.round(cardW*0.03) + 'px Arial';
        ctx.fillText(pvDate.textContent, cx + cardW - innerPad - 4, posterY + 22);
        ctx.fillStyle = '#bdbdbd';
        ctx.fillText(pvTime.textContent, cx + cardW - innerPad - 4, posterY + 54);
        ctx.textAlign = 'start';

        // big QR placeholder centered under title block
        const qSize = Math.round(cardW * 0.42); // corresponds to ~220px when W~1000
        const qX = cx + Math.round((cardW - qSize)/2);
        const qY = posterY + posterH + Math.round(cardW*0.04);
        ctx.fillStyle = '#ffffff';
        roundRect(ctx, qX, qY, qSize, qSize, 20, true, false);

        // SCREEN / SEAT / THEATRE
        ctx.textAlign = 'center';
        ctx.fillStyle = '#bdbdbd';
        ctx.font = Math.round(cardW*0.022) + 'px Arial';
        ctx.fillText('SCREEN', cx + cardW/2, qY + qSize + Math.round(cardW*0.07));
        ctx.fillStyle = '#fff';
        ctx.font = '700 ' + Math.round(cardW*0.03) + 'px Arial';
        ctx.fillText(pvScreen.textContent, cx + cardW/2, qY + qSize + Math.round(cardW*0.115));

        ctx.fillStyle = '#bdbdbd';
        ctx.font = Math.round(cardW*0.022) + 'px Arial';
        ctx.fillText('SEAT', cx + cardW/2, qY + qSize + Math.round(cardW*0.18));
        ctx.fillStyle = '#fff';
        ctx.font = '700 ' + Math.round(cardW*0.03) + 'px Arial';
        ctx.fillText(pvSeats.textContent, cx + cardW/2, qY + qSize + Math.round(cardW*0.225));

        // perforation line
        const perY = qY + qSize + Math.round(cardW*0.27);
        ctx.strokeStyle = 'rgba(255,255,255,0.08)';
        ctx.lineWidth = Math.max(1, Math.round(cardW*0.002));
        dashedLine(ctx, cx + innerPad, perY, cx + cardW - innerPad, perY, Math.round(cardW*0.018), Math.round(cardW*0.012));

        // address block
        ctx.textAlign = 'center';
        ctx.fillStyle = '#d6d6d6';
        ctx.font = Math.round(cardW*0.02) + 'px Arial';
        wrapText(ctx, pvAddress.textContent, cx + innerPad, perY + Math.round(cardW*0.04), cardW - innerPad*2, Math.round(cardW*0.03));

        // booking id
        ctx.fillStyle = 'rgba(255,255,255,0.6)';
        ctx.font = Math.round(cardW*0.018) + 'px Arial';
        ctx.fillText(pvBooking.textContent, cx + cardW/2, cy + cardH - innerPad - Math.round(cardW*0.14));

        // bottom logo (use your uploaded PNG)
        const bottomLogo = new Image();
        bottomLogo.crossOrigin = 'anonymous';
        bottomLogo.onload = function(){
          const lw = Math.round(cardW*0.33);
          const lh = Math.round(bottomLogo.height/bottomLogo.width * lw);
          ctx.drawImage(bottomLogo, cx + innerPad, cy + cardH - innerPad - lh, lw, lh);
          // hashtag on right
          ctx.textAlign = 'right';
          ctx.fillStyle = '#fff';
          ctx.font = '700 ' + Math.round(cardW*0.05) + 'px Arial';
          ctx.fillText('#SeeYouThere', cx + cardW - innerPad, cy + cardH - innerPad - Math.round(lh/3));
          finalize();
        };
        bottomLogo.onerror = function(){
          // fallback text
          ctx.font = '700 ' + Math.round(cardW*0.04) + 'px Arial';
          ctx.fillStyle = '#fff';
          ctx.fillText('district', cx + innerPad, cy + cardH - innerPad - 30);
          ctx.textAlign = 'right';
          ctx.fillText('#SeeYouThere', cx + cardW - innerPad, cy + cardH - innerPad - 30);
          finalize();
        };
        // use raw GitHub URL provided previously
        bottomLogo.src = 'https://github.com/rahulchakradhar30/tickets/blob/main/brand-logo.png?raw=true';
      } // end afterPoster
    } // end afterTopLogo

    function finalize(){
      // create filename and download
      const a = document.createElement('a');
      a.href = off.toDataURL('image/png');
      a.download = filename || (pvTitle.textContent + '-ticket.png');
      a.click();
    }

    // helper drawing functions
    function roundRect(ctx,x,y,w,h,r,fill,stroke){
      if(typeof r==='undefined') r=6;
      ctx.beginPath();
      ctx.moveTo(x+r,y);
      ctx.arcTo(x+w,y,x+w,y+h,r);
      ctx.arcTo(x+w,y+h,x,y+h,r);
      ctx.arcTo(x,y+h,x,y,r);
      ctx.arcTo(x,y,x+w,y,r);
      ctx.closePath();
      if(fill) ctx.fill();
      if(stroke) ctx.stroke();
    }
    function wrapText(ctx, text, x, y, maxWidth, lineHeight){
      ctx.textAlign = 'left';
      const words = text.split(' ');
      let line = '';
      for(let n=0;n<words.length;n++){
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        const testWidth = metrics.width;
        if(testWidth > maxWidth && n>0){
          ctx.fillText(line, x, y);
          line = words[n] + ' ';
          y += lineHeight;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line, x, y);
    }
    function dashedLine(ctx, x1, y1, x2, y2, dash, gap){
      ctx.beginPath();
      const dx = x2 - x1, dy = y2 - y1;
      const dist = Math.sqrt(dx*dx + dy*dy);
      const seg = dash + gap;
      const steps = Math.floor(dist / seg);
      const vx = dx / dist * seg;
      const vy = dy / dist * seg;
      for(let i=0;i<steps;i++){
        const sx = x1 + i*vx;
        const sy = y1 + i*vy;
        const ex = sx + (dx/dist)*dash;
        const ey = sy + (dy/dist)*dash;
        ctx.moveTo(sx, sy);
        ctx.lineTo(ex, ey);
      }
      ctx.stroke();
    }
  } // end buildAndDownload

  // UI download wrapper
  window.downloadTicketFromUI = function(){
    const mode = document.getElementById('exportMode').value;
    if(mode === 'standard'){
      // Standard: 1000 x 1600 (keeps proportions)
      buildAndDownload(1000, 1600, (pvTitle.textContent || 'ticket') + '-standard.png');
    } else {
      // District original: 720 x 1280 (exact sample)
      buildAndDownload(720, 1280, (pvTitle.textContent || 'ticket') + '-district.png');
    }
  };

})();
</script>
</body>
</html>
